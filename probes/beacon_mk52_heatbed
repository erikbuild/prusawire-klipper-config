[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_<..addyourserial..>-if00
x_offset: 0 # update with offset from nozzle on your machine
y_offset: 14.6 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
home_gcode_pre_x: _HOME_PRE_AXIS AXIS=X
home_gcode_post_x: _HOME_POST_AXIS AXIS=X
home_gcode_pre_y: _HOME_PRE_AXIS AXIS=Y
home_gcode_post_y: _HOME_POST_AXIS AXIS=Y
home_xy_position: 70, 30 # update with your safe spot without bed magnets
home_z_hop: 3
home_z_hop_speed: 30
home_xy_move_speed: 150
home_method: contact # use proximity for induction homing
home_method_when_homed: proximity # after initial calibration use induction
home_autocalibrate: unhomed # contact will calibrate beacon on first home
contact_max_hotend_temperature: 170

[bed_mesh]
speed: 150
#horizontal_move_z: 16.55
mesh_min: 25,25
mesh_max: 225,170
probe_count: 50,50
algorithm: bicubic
fade_start: 1
fade_end: 10
fade_target: 0
faulty_region_1_min: 122, 0
faulty_region_1_max: 152, 24
faulty_region_2_min: 186, 0
faulty_region_2_max: 250, 30
faulty_region_3_min: 106, 35
faulty_region_3_max: 143, 77
faulty_region_4_min: 209, 55
faulty_region_4_max: 250, 70
faulty_region_5_min: 0, 80
faulty_region_5_max: 101, 123
faulty_region_6_min: 153, 87
faulty_region_6_max: 250, 125
faulty_region_7_min: 105, 127
faulty_region_7_max: 147, 172
faulty_region_8_min: 96, 181
faulty_region_8_max: 130, 232
faulty_region_9_min: 175, 176
faulty_region_9_max: 214, 232

[gcode_macro _HOME_PRE_AXIS]
gcode:
  # Adapt this for your printer.
  {% set RUN_CURRENT_X = printer.configfile.settings['tmc2209 stepper_x'].run_current|float %}
    {% set RUN_CURRENT_Z = printer.configfile.settings['tmc2209 stepper_z'].run_current|float %}
    {% set RUN_CURRENT_Y = printer.configfile.settings['tmc2209 stepper_y'].run_current|float %}
    {% set HOME_CURRENT_X = RUN_CURRENT_X / 2 %}
    {% set HOME_CURRENT_Z = RUN_CURRENT_Z / 2 %}
    {% set HOME_CURRENT_Y = RUN_CURRENT_Y / 2 %}

    SET_TMC_CURRENT STEPPER=stepper_x CURRENT={HOME_CURRENT_X}
    SET_TMC_CURRENT STEPPER=stepper_z CURRENT={HOME_CURRENT_Z}
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT={HOME_CURRENT_Y}

[gcode_macro _HOME_POST_AXIS]
gcode:
  {% set axis = params.AXIS %}
  {% set RUN_CURRENT_X = printer.configfile.settings['tmc2209 stepper_x'].run_current|float %}
  {% set RUN_CURRENT_Z = printer.configfile.settings['tmc2209 stepper_z'].run_current|float %}
  {% set RUN_CURRENT_Y = printer.configfile.settings['tmc2209 stepper_y'].run_current|float %}

  # Move away
  SAVE_GCODE_STATE NAME=home_post_axis
  G91
  G0 {axis} 10 F3600
  RESTORE_GCODE_STATE NAME=home_post_axis

  # Make sure StallGuard registers are cleared
  M400
  # Set current during print
  SET_TMC_CURRENT STEPPER=stepper_x CURRENT={RUN_CURRENT_X}
  SET_TMC_CURRENT STEPPER=stepper_z CURRENT={RUN_CURRENT_Z}
  SET_TMC_CURRENT STEPPER=stepper_y CURRENT={RUN_CURRENT_Y}
